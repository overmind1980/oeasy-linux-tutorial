---
show: step
version: 1.0
enable_checker: true
---

# å…ˆæŸ¥è¯¢å†æ’å…¥

### å›å¿†
- ä¸Šæ¬¡ç ”ç©¶äº†è¡¨å•æäº¤ä¿¡æ¯çš„å…¥åº“
- æ•´åˆäº†æ¥æ”¶postè¿‡æ¥çš„æ•°æ®å’Œæ’å…¥æ•°æ®åº“çš„ä»£ç 
- å°†æ¥æ”¶åˆ°çš„è¡¨å•æ•°æ®ç›´æ¥æ’å…¥æ•°æ®åº“
- ä½†æ˜¯å¦‚æœå·²ç»æœ‰äº†çš„ç”¨æˆ·åï¼Œé‡æ–°æäº¤ä¼šå¦‚ä½•å‘¢ï¼Ÿï¼ŸğŸ¤”

### æˆ‘ä»¬æ¥è¯•è¯•

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211130-1638240643710)

- å·²ç»æœ‰äº†aaa
- æˆ‘ä»¬è¿˜è¦æ’å…¥aaa
- ç»“æœè‚¯å®šæ˜¯æ— æ³•é‡å¤æ’å…¥çš„

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211130-1638240830697)

- è€Œä¸”è¿”å›äº†ä¸€ä¸ªç™½å±
- é‚£æˆ‘ä»¬åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ

### çœ‹æ—¥å¿—

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211130-1638240861142)

- è¿™å¥sqlè¯­å¥æ˜¯å¯ä»¥çœ‹åˆ°çš„
- æ’å…¥ä¹‹åè¿”å›çš„é”™è¯¯ä¹Ÿæ˜¯å¯çœ‹åˆ°çš„
- æˆ‘ä»¬ç”šè‡³å¯ä»¥ç›´æ¥å»psqlé‡Œé¢è¯•è¯•è¿™å¥è¯

### é‡å¤æ’å…¥

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211130-1638241035226)

- å› ä¸ºè¿™ç§uniqueçº¦æŸçš„å­˜åœ¨
- åŒæ ·çš„ç”¨æˆ·åæ˜¯ä¸èƒ½é‡å¤æ’å…¥çš„
- ä½†æ˜¯è¿™ç§è¿”å›ç™½å±æ˜¯å¾ˆå®¹æ˜“è®©äººå›°æƒ‘çš„
- æˆ‘ä»¬åº”è¯¥æ˜ç¡®åœ°å‘Šè¯‰ç”¨æˆ·
- è¿™ä¸ªç”¨æˆ·åå·²ç»å­˜åœ¨
- è¯·æ¢ä¸€ä¸ªç”¨æˆ·å
- é‚£å°±éœ€è¦åœ¨æ’å…¥ä¹‹å‰è¿›è¡Œåˆ¤æ–­

### å…ˆåˆ¤æ–­

```java
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.Statement;
import java.io.IOException;
import java.io.PrintWriter;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
public class InsertServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;
    @Override
    public void doPost(HttpServletRequest request,
                      HttpServletResponse response)
        throws IOException, ServletException
    {
		request.setCharacterEncoding("utf-8");
        response.setContentType("text/html");
        response.setCharacterEncoding("UTF-8");
        PrintWriter out = response.getWriter();
		Connection c = null;
		Statement stmt = null;
		try {
			Class.forName("org.postgresql.Driver");
			c = DriverManager.getConnection(
					"jdbc:postgresql://localhost:5432/oeasy", "postgres",
					"oeasy@pq");
			c.setAutoCommit(false);
			out.println("db connection is ok!!<br/>");
			stmt = c.createStatement();
			String Username = request.getParameter("username");
			String Password = request.getParameter("password");
			ResultSet rs = stmt.executeQuery("select * from login where Username='"+Username+"'");
			if(rs.next()){
				response.sendRedirect("http://localhost:8080/oeasy/error?msg=ç”¨æˆ·åå·²ç»å­˜åœ¨");
			}
			String sql = "insert into login(username,password) values('"+Username+"','"+Password+"');";
			System.out.print("sql======================" + sql);
			stmt.executeUpdate(sql);
			stmt.close();
			c.commit();
			c.close();

		} catch (Exception e) {
			e.printStackTrace();
			System.err.println(e.getClass().getName() + ": " + e.getMessage());
			System.exit(0);
		}
		response.sendRedirect("http://localhost:8080/oeasy/select");
    }
}
```

### æ–°å»ºerroræ˜ å°„

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211130-1638243308689)

### ErrorServlet.java

```java
import java.io.IOException;
import java.io.PrintWriter;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
public class ErrorServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;
    public void doGet(HttpServletRequest request,
                      HttpServletResponse response)
        throws IOException, ServletException{
		request.setCharacterEncoding("utf-8");
        response.setContentType("text/html");
        response.setCharacterEncoding("utf-8");
        PrintWriter out = response.getWriter();
        out.println("<!DOCTYPE html><html><body>");
		String ErrorMessage = request.getParameter("msg");
        if(ErrorMessage.equals("usernameExists")){
		    out.print("è¿™ä¸ªç”¨æˆ·åå·²ç»å­˜åœ¨ï¼Œè¯·é‡æ–°é€‰æ‹©!");
        }
        out.print("<a href=\"./prepareInsert.html\">è¿”å›æ³¨å†Œé¡µé¢</a>");
        out.println("</body></html>");
    }
}
```

### æŠ¥é”™ä¿¡æ¯

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211130-1638243754158)

- ä»çº¢è‰²çš„è¿çº¿å¯çŸ¥
- æŠ¥é”™ä¿¡æ¯ç¡®å®æ˜¯ç”¨getçš„æ–¹å¼ä¼ é€’åˆ°ErrorServlet.classå½“ä¸­çš„
- è¿™æ ·é‡å¤ç”¨æˆ·åæ³¨å†Œçš„é—®é¢˜å°±è§£å†³äº†

### æ€»ç»“
- è¿™æ¬¡è§£å†³äº†é‡å¤ç”¨æˆ·åçš„é—®é¢˜
- ä½†æ˜¯è¿˜æ˜¯å¯èƒ½æœ‰é—®é¢˜çš„
- æ¯”å¦‚æ•°æ®åº“ä¸­æˆ‘ä»¬çš„æ•°æ®å­˜å‚¨å®½åº¦æ˜¯30

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211130-1638244120503)

- å¦‚æœæäº¤çš„å­—ç¬¦ä¸²é•¿åº¦å¤§äº30ï¼Œä¼šå¦‚ä½•å‘¢?ğŸ¤”
- ä¸‹æ¬¡å†è¯´ï¼ğŸ‘‹