---
show: step
version: 1.0
enable_checker: true
---

# ç”¨ç½‘é¡µæ’å…¥æ•°æ® - æ–‡æœ¬æ¡†

### å›å¿†

- ä¸Šæ¬¡ç ”ç©¶äº†æ–‡æœ¬æ¡†æäº¤è¡¨å•
- æäº¤è¡¨å•æœ‰ä¸¤ç§æ–¹å¼
	- Get ç›´æ¥å†™åœ¨åœ°å€æ  ç®€å•æ˜äº†
	- Post éšè—èµ·æ¥ ä¿å¯†æ€§å¼º
- æäº¤çš„è¡¨å•è¦æœ‰ä¸€ä¸ªæ¥æ”¶çš„url
- è¿™ä¸ªurlå¯¹åº”çš„servletå¯ä»¥å¤„ç†ç›¸å…³æ•°æ®
	- å¯ä»¥æ’å…¥æ•°æ®åˆ°æ•°æ®åº“
	- æ’å…¥æ•°æ®åˆ°æ•°æ®åº“å‰é¢åšè¿‡
- ç°åœ¨å°±æ˜¯è¦æŠŠæ¥æ”¶è¡¨å•æ•°æ®å’Œæ’å…¥æ•°æ®åº“è®°å½•æ•´åˆèµ·æ¥
	- æŠŠè¡¨å•æ¥æ”¶åˆ°çš„æ•°æ®
	- æ’å…¥åˆ°æ•°æ®åº“çš„è¡¨ä¸­
	- æ·»åŠ ä¸€æ¡è®°å½•
- å¦‚ä½•æ•´åˆå‘¢ï¼ŸğŸ¤”

### ä¸¤æ®µä»£ç 

- æ¥æ”¶æäº¤æ•°æ®

```java
import java.io.*;
import jakarta.servlet.*;
import jakarta.servlet.http.*;
public class TestServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;
    public void doGet(HttpServletRequest request,
                      HttpServletResponse response)
        throws IOException, ServletException
    {
        response.setContentType("text/html");
        request.setCharacterEncoding("utf-8");
        PrintWriter out = response.getWriter();
        out.println("<!DOCTYPE html><html><body>");
        String Username = request.getParameter("username");
        String Password = request.getParameter("password");
        out.print("??????:"+Username);
        System.out.print("??????:"+Username);
        out.print("????"+Password);
        out.println("</body></html>");
    }
    public void doPost(HttpServletRequest request,
                      HttpServletResponse response)
        throws IOException, ServletException
    {
		doGet(request,response);
    }
}
```

- æ’å…¥æ•°æ®


```
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.Statement;
import java.io.IOException;
import java.io.PrintWriter;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
public class InsertServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;
    @Override
    public void doGet(HttpServletRequest request,
                      HttpServletResponse response)
        throws IOException, ServletException
    {
        response.setContentType("text/html");
        response.setCharacterEncoding("UTF-8");
        PrintWriter out = response.getWriter();
		Connection c = null;
		Statement stmt = null;
		try {
			Class.forName("org.postgresql.Driver");
			c = DriverManager.getConnection(
					"jdbc:postgresql://localhost:5432/oeasy", "postgres",
					"oeasy@pq");
			c.setAutoCommit(false);
			stmt = c.createStatement();

			String sql = "insert into urls(topic,url) values('oeasy','http://oeasy.org');";
			System.out.print("sql======================" + sql);
			stmt.executeUpdate(sql);
			stmt.close();
			c.commit();
			c.close();

		} catch (Exception e) {
			e.printStackTrace();
			System.err.println(e.getClass().getName() + ": " + e.getMessage());
		}
		response.sendRedirect("http://localhost:8080/oeasy/select");
    }
}
```

### æ³¨å†Œ

- æˆ‘ä»¬è¿™æ¬¡è¦åšä¸€ä¸ªæ³¨å†Œé¡µé¢
	- æ³¨å†Œçš„ç»“æœå°±æ˜¯å¾€loginè¡¨ä¸­æ’å…¥æ•°æ®
	- loginçš„æ„æ€æ˜¯ç™»å½•
	- å¯¹åº”æ‰€æœ‰çš„ç”¨æˆ·åå’Œå¯†ç 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220521-1653139161968)

- loginæ¥è‡ªäºlogåŸæœ¨
	- æŒ‡çš„æ˜¯èˆªæµ·ä¸­è®°å½•èˆªé€Ÿçš„å·¥å…·
	- æ ¹æ®èˆªé€Ÿè®°å½•èˆªæµ·æ—¥å¿—
	- ä»¥è‡³äºåæ¥è®¡ç®—æœºçš„ç™»å½•æ•°æ®
	- æˆ‘ä»¬ç°åœ¨ç”¨loginè¡¨æ¥è®°å½•çš„æ³¨å†Œç”¨æˆ·

### æ•´åˆä»£ç 

```java
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.Statement;
import java.io.IOException;
import java.io.PrintWriter;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
public class InsertServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;
    @Override
    public void doPost(HttpServletRequest request,
                      HttpServletResponse response)
        throws IOException, ServletException
    {
		request.setCharacterEncoding("utf-8");
        response.setContentType("text/html");
        response.setCharacterEncoding("UTF-8");
        PrintWriter out = response.getWriter();
		Connection c = null;
		Statement stmt = null;
		try {
			Class.forName("org.postgresql.Driver");
			c = DriverManager.getConnection(
					"jdbc:postgresql://localhost:5432/oeasy", "postgres",
					"oeasy@pg");
			c.setAutoCommit(false);
			out.println("db connection is ok!!<br/>");
			stmt = c.createStatement();
			String Username = request.getParameter("username");
			String Password = request.getParameter("password");
			String sql = "insert into login(username,password) values('"+Username+"','"+Password+"');";
			System.out.print("sql======================" + sql);
			stmt.executeUpdate(sql);
			stmt.close();
			c.commit();
			c.close();

		} catch (Exception e) {
			e.printStackTrace();
			System.err.println(e.getClass().getName() + ": " + e.getMessage());
		}
		response.sendRedirect("http://localhost:8080/oeasy/select");
    }
     public void doPost(HttpServletRequest request,
                      HttpServletResponse response)
        throws IOException, ServletException
    {
    	doGet(request,response);
    }
}
```

- ä¿®æ”¹å
	- æ’å…¥çš„æ˜¯loginæ•°æ®åº“
	- å®Œæˆçš„æ˜¯ä¸€ä¸ªæ³¨å†Œçš„è¿‡ç¨‹
	- æ‰€æœ‰è¦æœ‰ä¸€ä¸ªloginè¡¨

### å»ºè¡¨

```sql
create table login(
	id serial primary key,
	username varchar(30) unique,
	password varchar(30)
);
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211130-1638237412014)

### ç½‘é¡µè¡¨å•çš„action

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211130-1638237716825)

- ä¿®æ”¹ä¹‹åæäº¤

### è¾“å‡ºé‡å®šå‘

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211130-1638237766418)

- responseé‡å®šå‘åˆ°äº†select
- å¯¹åº”SelectServlet.java
- è¿˜æ˜¯åœ¨æŸ¥è¯¢urlsè¡¨
- ç°åœ¨æˆ‘è¦æŸ¥è¯¢loginè¡¨

### ä¿®æ”¹InsertServlet.java
```java
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.Statement;
import java.io.IOException;
import java.io.PrintWriter;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
public class InsertServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;
    @Override
    public void doGet(HttpServletRequest request,
                      HttpServletResponse response)
        throws IOException, ServletException
    {
		request.setCharacterEncoding("utf-8");
        response.setContentType("text/html");
        response.setCharacterEncoding("UTF-8");
        PrintWriter out = response.getWriter();
        out.println("<!DOCTYPE html><html><body>");
		Connection c = null;
		Statement stmt = null;
		try {
			Class.forName("org.postgresql.Driver");
			c = DriverManager.getConnection(
					"jdbc:postgresql://localhost:5432/oeasy", "postgres",
					"oeasy@pg");
			c.setAutoCommit(false);
			out.println("db connection is ok!!<br/>");
			stmt = c.createStatement();
			String Username = request.getParameter("username");
			String Password = request.getParameter("password");
			String sql = "insert into login(username,password) values('"+Username+"','"+Password+"');";
			System.out.print("sql======================" + sql);
			stmt.executeUpdate(sql);
			stmt.close();
			c.commit();
			c.close();

		} catch (Exception e) {
			e.printStackTrace();
			System.err.println(e.getClass().getName() + ": " + e.getMessage());
		}
		response.sendRedirect("http://localhost:8080/oeasy/select");
		out.println(" data query is ok!<br/>");
        out.println("</body></html>");
    }     
    public void doPost(HttpServletRequest request,
                      HttpServletResponse response)
        throws IOException, ServletException
    {
    	doGet(request,response);
    }
}
```

### æ’å…¥è¿‡ç¨‹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211130-1638239604185)

- ç½‘é¡µä¸­çš„è¡¨å•poståˆ°/insertè¿™ä¸ªurl
- /insertæ ¹æ®web.xmlçš„è·¯ç”±åˆ°InsertServlet.class
- InsertServlet.classæ¥æ”¶è¡¨å•æ•°æ®å¹¶æ’å…¥æ•°æ®åˆ°åº“
- è¾“å‡ºå“åº”é‡å®šå‘åˆ°/selectè¿™ä¸ªurl
- è·¯ç”±åˆ°SelectServlet.class
- SelectServlet.classå»æ•°æ®åº“ä¸­å–å¾—loginè¡¨ä¸­çš„è®°å½•
- ç„¶ååœ¨é¡µé¢å±•ç¤º

### æ€»ç»“
- æˆ‘ä»¬è¿™æ¬¡ç ”ç©¶äº†è¡¨å•æäº¤ä¿¡æ¯çš„å…¥åº“
	- å°±æ˜¯ä¸€ä¸ªæ³¨å†Œçš„è¿‡ç¨‹
	- æˆ‘ä»¬æ•´åˆäº†æ¥æ”¶postè¿‡æ¥çš„æ•°æ®å’Œæ’å…¥æ•°æ®åº“çš„ä»£ç 
	- å°†æ¥æ”¶åˆ°çš„è¡¨å•æ•°æ®ç›´æ¥æ’å…¥æ•°æ®åº“
- ä½†æ˜¯å¦‚æœå·²ç»æœ‰äº†çš„ç”¨æˆ·å
	- é‡æ–°æäº¤ä¼šå¦‚ä½•å‘¢ï¼Ÿï¼ŸğŸ¤”
- ä¸‹æ¬¡å†è¯´ï¼ğŸ‘‹