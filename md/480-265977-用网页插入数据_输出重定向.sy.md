---
show: step
version: 1.0
enable_checker: true
---

# ä¿®æ”¹è¡¨ç»“æ„

### å›å¿†
- æˆ‘ä»¬è¿™æ¬¡ç ”ç©¶äº†è¡¨çš„ä¿®æ”¹
	- å¯ä»¥æ·»åŠ åˆ é™¤åˆ—
		- alter table table_name add column_name datatype;
		- alter table table_name drop column_name datatype;
	- ä¿®æ”¹åˆ—
		- alter table table_name alter column column_name type datatype;
		- alter table table_name alter column column_name set not null;
		- alter table table_name add constraint unique_name(column_name1,column_name2);
	- æ·»åŠ ä¿®æ”¹ä¸»é”®çº¦æŸ
		- alter table drop constraint primary_key_name;
		- alter table add constraint primary_key_name primary key(column_name1,column_name2);
	- ä¿®æ”¹åˆ—å
		- alter table table_name rename column_origin_name to column_dest_name;
- ä¸è¿‡åˆ°ç°åœ¨è¿˜æ˜¯æ²¡æœ‰æ’å…¥æ•°æ®å•Š
- å¦‚ä½•æ’å…¥æ•°æ®å‘¢ï¼ŸğŸ¤”

### è§‚å¯Ÿä¸€ä¸‹ç°åœ¨çš„è¡¨ç»“æ„

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211125-1637811751970)

- ç°åœ¨ä¸¤ä¸ªå­—æ®µ
	- éƒ½æ˜¯éç©ºçš„
- å¦‚æœæ­£å¸¸æ’å…¥åº”è¯¥æ˜¯ä»€ä¹ˆæ•ˆæœå‘¢ï¼Ÿ

### æ’å…¥æ•°æ®

```sql
insert into urls(topic,url) values('tom','http://tom.com');
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211128-1638102097746)

- ä½†æ˜¯å¦‚æœæˆ‘è¦æ’å…¥ç©ºå€¼å‘¢ï¼Ÿ

### æ’å…¥ç©ºä¸²

```sql
insert into urls(topic,url) values('null','');
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211128-1638102205536)

- è¿™ä¸ªè¿˜æ˜¯æ’å…¥äº†
- å› ä¸ºç›®æ ‡å­—æ®µçš„å†…å®¹æ˜¯ç©ºçš„å­—ç¬¦ä¸²
- ä»–å’Œç©ºå€¼è¿˜ä¸ä¸€æ ·
- é‚£ä»€ä¹ˆæ˜¯ç©ºå€¼å‘¢ï¼Ÿ

### æ’å…¥ç©ºå€¼

```sql
insert into urls(topic) values('something');
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211128-1638102296974)

- è¿™ä¸ªç¡®å®ä¸è¡Œå•Š
- å› ä¸ºæ•°æ®åº“çš„urlå­—æ®µæœ‰not nullçš„çº¦æŸ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211125-1637811751970)

- é‚£æˆ‘å¯ä»¥å»æ‰è¿™ä¸ªéç©ºçš„çº¦æŸä¹ˆï¼Ÿ

### æŸ¥è¯¢

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211128-1638102417632)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211128-1638102425515)

### è¯•è¯•

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211128-1638102547555)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211128-1638102554011)

- ä¿®æ”¹äº†ä¹‹åå°±å¯ä»¥æ’å…¥äº†ä¹ˆï¼Ÿ

### æ’å…¥

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211128-1638102597167)

- ç¡®å®å¯ä»¥æ’å…¥äº†
- ä¸è¿‡å­—æ®µç©¶ç«Ÿæ˜¯ä¸æ˜¯åº”è¯¥not null
- ä¸€å®šè¦åœ¨å»ºç«‹æ•°æ®åº“çš„åˆæœŸå°±è®¾è®¡å¥½
- æˆ‘å¯ä»¥ç”¨servletæ’å…¥æ•°æ®ä¹ˆï¼Ÿ

### ä½¿ç”¨servlet

- é…ç½®urlçš„è·¯ç”±

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211128-1638103178576)

### è·¯ç”±åˆ†æ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210913-1631496871039)

- ç°åœ¨éœ€è¦ä¸€ä¸ªInsertServlet.classæ–‡ä»¶
- å…ˆå¤åˆ¶å‡ºä¸€ä¸ªjavaæ–‡ä»¶
- ç„¶åå¯¹äºæ–‡ä»¶è¿›è¡Œä¿®æ”¹

### InsertServlet.java

```java
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.Statement;
import java.io.IOException;
import java.io.PrintWriter;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
public class InsertServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;
    @Override
    public void doGet(HttpServletRequest request,
                      HttpServletResponse response)
        throws IOException, ServletException
    {
        response.setContentType("text/html");
        response.setCharacterEncoding("UTF-8");
        PrintWriter out = response.getWriter();
        out.println("<!DOCTYPE html><html><body>");
		Connection c = null;
		Statement stmt = null;
		try {
			Class.forName("org.postgresql.Driver");
			c = DriverManager.getConnection(
					"jdbc:postgresql://localhost:5432/oeasy", "postgres",
					"oeasy@pq");
			c.setAutoCommit(false);

			out.println("db connection is ok!!<br/>");
			stmt = c.createStatement();

			String sql = "insert into urls(topic,url) values('oeasy','http://oeasy.org');";
			System.out.print("sql======================" + sql);
			stmt.executeUpdate(sql);
			stmt.close();
			c.commit();
			c.close();

		} catch (Exception e) {
			e.printStackTrace();
			System.err.println(e.getClass().getName() + ": " + e.getMessage());
			System.exit(0);
		}
		//response.sendRedirect("http://localhost:8080/oeasy/select");
		out.println(" data query is ok!<br/>");
        out.println("</body></html>");
    }
}
```

- æ³¨æ„è¿™é‡Œå’ŒæŸ¥è¯¢ä¸åŒçš„åœ°æ–¹
	- æŸ¥è¯¢
		- stmt.excuteQuery(sql)
	- æ›´æ–°
		- stmt.excuteUpdate(sql)
		- è€Œä¸”éœ€è¦æœ€åcommitä¸€ä¸‹
- å¯ä»¥è¿è¡Œä¹ˆï¼Ÿ
- ç¼–è¯‘ä»–ç„¶å
- é‡å¯tomcatæ¥çœ‹çœ‹

### é‡å¯tomcat

- é‡å¯åè¿è¡Œæ¯”è¾ƒé¡ºåˆ©
- å³ä½¿ä¸é¡ºåˆ©çš„è¯
- ä¹Ÿå¯ä»¥åˆ°logs/catalina.outä¸­æŸ¥çœ‹è¾“å‡ºåˆ°æ—¥å¿—ä¸­çš„ä¿¡æ¯
	- ç”šè‡³å¯ä»¥æŠŠä¸Šå›¾è¾“å‡ºåˆ°æ—¥å¿—çš„sqlè¯­å¥æ”¾åˆ°pqä¸­æ‰§è¡Œ
- è¿›è¡Œæ’é”™

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211128-1638105179607)

- é‚£è¿™ä¸ªæ•°æ®ä»–æ’è¿›å»äº†ä¹ˆï¼Ÿ

### pq

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211128-1638108597484)

- è¿™ä¸ªæ•°æ®ç¡®å®æ’è¿›å»äº†
- ä½†å¦‚æœæˆ‘æƒ³å†æ’åŒæ ·çš„æ•°æ®ä¼šå¦‚ä½•å‘¢ï¼Ÿ

### æŠ¥é”™

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211128-1638108660483)

- å¦‚æœæ˜¯åœ¨é¡µé¢ä¸Šæ’å…¥ä¼šå¦‚ä½•å‘¢ï¼Ÿ
- tomcatä¼šå´©æºƒ
- å»æ—¥å¿—çœ‹çœ‹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211128-1638108716480)


- é—®é¢˜å…¶å®æ˜¯uniqueçº¦æŸ
- æˆ‘ä»¬å…ˆæŠŠè¿™ä¸ªçº¦æŸå»äº†è¯•è¯•

### å»æ‰uniqueçº¦æŸ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211128-1638109006307)

- ç„¶åæˆ‘ä»¬æ˜¯å¦å°±å¯ä»¥åå¤æ’å…¥ç›¸åŒæ•°æ®äº†ï¼Ÿ

### åå¤æ’å…¥

- é‡å¯ä¸€ä¸‹tomcat
- åœ¨åœ°å€æ é‡Œé¢åå¤åˆ·æ–°å‡ æ¬¡
- ç„¶åå»æ•°æ®åº“é‡Œé¢è§‚å¯Ÿ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211128-1638109129567)

- ä½†æ˜¯å¦‚æœæˆ‘æƒ³æ’å…¥ä¹‹åç›´æ¥è·³è½¬åˆ°/selectæŸ¥è¯¢é¡µé¢
- ç›´æ¥å°±èƒ½çœ‹è§
- å¯ä»¥ä¹ˆï¼Ÿ

### æœç´¢

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211128-1638105328982)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211128-1638105340016)

- åœ¨æœåŠ¡å™¨ç«¯
- è®©responseé‡å®šå‘åˆ°/select ç„¶åç›´æ¥æŠŠç»“æœç»™è¿‡å»å¥½åƒå°±è¡Œäº†
- è¯•è¯•å»

### é‡å®šå‘

- æˆ‘ä»¬é¦–å…ˆç¡®è®¤ä¸€ä¸‹/selectèƒ½å¦å‡ºæ¥

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211128-1638105609725)

- åº“é‡Œé¢æœ‰ä¸œè¥¿
- ä½†æ˜¯æŸ¥ä¸å‡ºæ¥
- ä¸ºä»€ä¹ˆï¼Ÿ

### sqlè¯­å¥ç­›é€‰é—®é¢˜
![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211128-1638105651334)

- sqlè¯­å¥éœ€è¦è°ƒæ•´
- æˆ‘ä»¬å…ˆæŠŠç­›é€‰å»äº†
- ç„¶åé‡æ–°ç¼–è¯‘
- å†å»åˆ·æ–°é¡µé¢

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211128-1638105906809)

- è¿™æ¬¡æ˜¯å¯ä»¥å¾—åˆ°æ•°æ®çš„


### SelectServlet.java
```java
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.Statement;
import java.io.IOException;
import java.io.PrintWriter;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
public class SelectServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;
    @Override
    public void doGet(HttpServletRequest request,
                      HttpServletResponse response)
        throws IOException, ServletException
    {
        response.setContentType("text/html");
        response.setCharacterEncoding("UTF-8");
        PrintWriter out = response.getWriter();
        out.println("<!DOCTYPE html><html><body>");
		Connection c = null;
		Statement stmt = null;
		try {
			Class.forName("org.postgresql.Driver");
			c = DriverManager.getConnection(
					"jdbc:postgresql://localhost:5432/oeasy", "postgres",
					"oeasy@pq");
			c.setAutoCommit(false);

			out.println("db connection is ok!!<br/>");
			stmt = c.createStatement();

			ResultSet rs = stmt.executeQuery("select * from urls where topic like 's%'");
			while(rs.next()){
				String topic = rs.getString("topic");
				String url = rs.getString("url");
				out.print(topic+":"+url+"<br/>");
			}
			rs.close();
			stmt.close();
			c.close();

		} catch (Exception e) {
			e.printStackTrace();
			System.err.println(e.getClass().getName() + ": " + e.getMessage());
			System.exit(0);
		}
		out.println(" data query is ok!<br/>");
        out.println("</body></html>");
    }
}
```

- é‡å®šå‘çš„ç›®æ ‡é¡µæ²¡æœ‰é—®é¢˜äº†
- æˆ‘ä»¬ç°åœ¨æ¥çœ‹ä¸€ä¸‹æ’å…¥é¡µ

### InsertServlet.java

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211128-1638106166305)

- æˆ‘ä»¬å…ˆæ’å…¥è¿™ä¸€å¥è¯
- ç„¶åå°è¯•ä¸€ä¸‹

### InsertServlet.java
```
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.Statement;
import java.io.IOException;
import java.io.PrintWriter;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
public class InsertServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;
    @Override
    public void doGet(HttpServletRequest request,
                      HttpServletResponse response)
        throws IOException, ServletException
    {
        response.setContentType("text/html");
        response.setCharacterEncoding("UTF-8");
        PrintWriter out = response.getWriter();
        out.println("<!DOCTYPE html><html><body>");
		Connection c = null;
		Statement stmt = null;
		try {
			Class.forName("org.postgresql.Driver");
			c = DriverManager.getConnection(
					"jdbc:postgresql://localhost:5432/oeasy", "postgres",
					"oeasy@pq");
			c.setAutoCommit(false);

			out.println("db connection is ok!!<br/>");
			stmt = c.createStatement();

			String sql = "insert into urls(topic,url) values('oeasy','http://oeasy.org');";
			System.out.print("sql======================" + sql);
			stmt.executeUpdate(sql);
			stmt.close();
			c.commit();
			c.close();

		} catch (Exception e) {
			e.printStackTrace();
			System.err.println(e.getClass().getName() + ": " + e.getMessage());
			System.exit(0);
		}
		response.sendRedirect("http://localhost:8080/oeasy/select");
		out.println(" data query is ok!<br/>");
        out.println("</body></html>");
    }
}
```
### åˆ·æ–°è·³è½¬

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211128-1638109379162)

- æ¯æ¬¡åˆ·æ–°ç¡®å®éƒ½èƒ½è·³è½¬
- æ•°æ®åº“ç¡®å®ä¹Ÿåœ¨æ›´æ–°
- å…¶å®æ—¢ç„¶InsertServlet.javaåªè´Ÿè´£
	- æ’å…¥æ•°æ®
	- è¾“å‡ºé‡å®šå‘
- é‚£é‡Œé¢çš„å…³äºè¾“å‡ºçš„ä»£ç å¯ä»¥è¿›è¡Œåˆ é™¤

### ä¼˜åŒ–ä»£ç  

```
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.Statement;
import java.io.IOException;
import java.io.PrintWriter;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
public class InsertServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;
    @Override
    public void doGet(HttpServletRequest request,
                      HttpServletResponse response)
        throws IOException, ServletException
    {
        response.setContentType("text/html");
        response.setCharacterEncoding("UTF-8");
        PrintWriter out = response.getWriter();
		Connection c = null;
		Statement stmt = null;
		try {
			Class.forName("org.postgresql.Driver");
			c = DriverManager.getConnection(
					"jdbc:postgresql://localhost:5432/oeasy", "postgres",
					"oeasy@pq");
			c.setAutoCommit(false);
			stmt = c.createStatement();

			String sql = "insert into urls(topic,url) values('oeasy','http://oeasy.org');";
			System.out.print("sql======================" + sql);
			stmt.executeUpdate(sql);
			stmt.close();
			c.commit();
			c.close();

		} catch (Exception e) {
			e.printStackTrace();
			System.err.println(e.getClass().getName() + ": " + e.getMessage());
			System.exit(0);
		}
		response.sendRedirect("http://localhost:8080/oeasy/select");
    }
}
```

### æ€»ç»“
- æˆ‘ä»¬è¿™æ¬¡ç ”ç©¶äº†æ’å…¥æ•°æ®
- è€Œä¸”æ˜¯ä»ç½‘é¡µçš„ä½ç½®æ’å…¥æ•°æ®
- æ’å…¥äº†ä¹‹åè¿˜èƒ½è¿›è¡Œåœ°å€çš„è·³è½¬
- ä¸è¿‡å¦‚æœæˆ‘æƒ³è¦çš„æ˜¯ä»ç½‘é¡µé‡Œé¢æ–‡æœ¬æ¡†æäº¤æ•°æ®
- ç„¶åæŠŠæ•°æ®æ’å…¥æ•°æ®åº“
- è¿™åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼ŸğŸ¤”
- ä¸‹æ¬¡å†è¯´ï¼ğŸ‘‹

