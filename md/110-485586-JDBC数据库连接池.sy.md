---
show: step
version: 1.0
enable_checker: true
---

# å°è£…æ•°æ®åº“è¿æ¥

## å›å¿†

- jndi
	- java Naming and Directory Interface
	- å¯ä»¥é…ç½®ä¸€äº›é€šç”¨çš„ä¿¡æ¯
- é€šè¿‡æŒ‡å®šçš„å››æ­¥
	1. æ„å»ºèµ„æºç±»com.mycompany.MyBean
	2. å£°æ˜èµ„æºå¼•ç”¨
	3. åœ¨ä»£ç ä¸­å¼•ç”¨
	4. é…ç½®èµ„æºå·¥å‚
- ç»è¿‡è¿™å››æ­¥
	- æˆ‘ä»¬å°±ä¸ºæ¯ä¸ªå…·ä½“webåº”ç”¨é…ç½®ä¸€äº›é€šç”¨èµ„æº
- æ•°æ®åº“è¿æ¥è²Œä¼¼æœ‰ä¸“é—¨çš„é…ç½®æ–¹æ³•ğŸ˜²
- æ€ä¹ˆé…ç½®å‘¢ï¼ŸğŸ¤”

### æ–‡æ¡£

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220504-1651670506568)

- JDBCæ•°æ®æºå±äºjndièµ„æº
- è¿™é‡Œé¢æåˆ°äº†ä¸€ä¸ªconnection poolçš„æ¦‚å¿µ
	- ä¹Ÿå°±æ˜¯æ•°æ®åº“è¿æ¥æ± 
- ä»€ä¹ˆæ˜¯æ•°æ®åº“è¿æ¥æ± çš„æ¦‚å¿µå‘¢ï¼Ÿ
	- æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä»€ä¹ˆæ˜¯æ± (pool)

### æ°´æ± 

- æ± çš„æ¦‚å¿µæˆ‘ä»¬ç»å¸¸å¬è¯´
	- æµé‡æ± 
	- è‰ºäººæ± 
	- èµ„é‡‘æ± 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220616-1655338141396)

- è¿™æœ‰ç‚¹æŠ½è±¡å•Š
- æ± æ¥è‡ªäºä»€ä¹ˆå‘¢ï¼Ÿ

## pool


![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220504-1651670572324)

- æŠŠæ°´å…ˆè“„èµ·æ¥
- æƒ³è¦ç”¨çš„æ—¶å€™ç›´æ¥å°±èƒ½ç”¨
- å°±æ˜¯æ°´æ± 

### é…’æ± 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220504-1651672985356)

- æŠŠé…’å…ˆè“„èµ·æ¥
- æƒ³è¦ç”¨çš„æ—¶å€™ç›´æ¥å°±èƒ½ç”¨
- å°±æ˜¯é…’æ± 

### ç”µæ± 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220504-1651670830918)

- æŠŠç”µå…ˆè“„èµ·æ¥
- æƒ³ç”¨çš„æ—¶å€™ç›´æ¥å°±èƒ½ç”¨
- å°±æ˜¯ç”µæ± 

### å°ä¾¿æ± 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220522-1653183199629)

- æŠŠå°ä¾¿è“„èµ·æ¥
- æƒ³ç”¨çš„æ—¶å€™ç›´æ¥å°±èƒ½ç”¨
- å°±æ˜¯å°ä¾¿æ± 
- å•Šï¼Œå¹¶ä¸æ˜¯...ğŸ˜¶

### æ•°æ®åº“è¿æ¥æ± 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220504-1651673447778)

- æŠŠæ•°æ®åº“è¿æ¥å…ˆè“„èµ·æ¥
- æƒ³ç”¨çš„æ—¶å€™ç›´æ¥å°±èƒ½ç”¨
- å°±æ˜¯æ•°æ®åº“è¿æ¥æ± 
- å¯æ˜¯è“„æ•°æ®åº“è¿æ¥æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ

### æ•°æ®åº“è¿æ¥

- Connectionæ˜¯ä¸€ä¸ªç±»çš„å¯¹è±¡
	- æ¯æ¬¡å®ä¾‹åŒ–éƒ½è¦åˆ†é…å†…å­˜
	- ä½¿ç”¨ä¹‹åå°±è¦é‡Šæ”¾å†…å­˜
	- é¢‘ç¹çš„åˆ†é…é‡Šæ”¾åè€Œæµªè´¹ç³»ç»Ÿèµ„æº
- å¹²è„†å…ˆè“„ç€100ä¸ªæ•°æ®åº“è¿æ¥
- æ²¡æœ‰äººæ¥
	- ä¹Ÿå…ˆæŠŠå†…å­˜åˆ†é…äº†
	- å…ˆå ç€ä½ç½®
- æœ‰äººæ¥
	- å°±ä»æ± å­é‡Œé¢æ‹¿ä¸€ä¸ªç°æˆçš„
	- ç”¨å®Œäº†æ”¾å›åˆ°æ± å­
	- çœçš„æ¥å›æ¥å»ç”³è¯·é‡Šæ”¾å†…å­˜
- è¿™ç§é¢„å…ˆè“„èµ·æ¥çš„æ–¹å¼
	- å°±æ˜¯æ± åŒ–
	- ç±»ä¼¼çš„è¿˜æœ‰
		- çº¿ç¨‹æ± 
		- å­—ç¬¦ä¸²å¸¸é‡æ± 
- å…·ä½“æ€ä¹ˆé…ç½®JDBCæ•°æ®æºå‘¢ï¼Ÿ

### æ–‡æ¡£

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220504-1651673888008)

- tomcaté»˜è®¤çš„æ•°æ®æºæ˜¯DBCP2è¿æ¥æ± 
- æ–¹æ³•æ˜¯è¦å†™è‡ªå·±çš„èµ„æºå·¥å‚
- è¿™äº›æ–¹æ³•éƒ½é€šç”¨äºå„ç§æ•°æ®åº“
- åé¢çš„æ–‡æ¡£æœ‰ä¸“é—¨ä»‹ç»postgresqlçš„æ•°æ®åº“è¿æ¥æ± é…ç½®æ–¹æ³•
- æˆ‘ä»¬ç›´æ¥è·³è¿‡å»

### ç¬¬ä¸€æ­¥

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220504-1651674281640)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220504-1651674227924)

- æŠŠpgçš„jdbcé©±åŠ¨ä¸‹è½½åˆ°$CATALINA_HOMEçš„libä¸‹

### ç¬¬äºŒæ­¥
![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220504-1651674588556)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220504-1651674867911)

- é…ç½®èµ„æºä¸Šä¸‹æ–‡

### ç¬¬ä¸‰æ­¥

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220504-1651674983340)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220504-1651674965141)

- é…ç½®èµ„æºå¼•ç”¨

### ç¬¬å››æ­¥

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220504-1651675935769)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220504-1651675944498)

- ä½¿ç”¨JDBCæ•°æ®æº
- å¼€å§‹ç¼–è¾‘ConnectionPool.java

### ä»£ç 

- åº”ç”¨æ•°æ®æºè¿æ¥æ± 

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220504-1651676060739)

### æºç 

- ä¿®æ”¹åçš„ä»£ç 

```java
import java.sql.*;
import java.io.*;
import jakarta.servlet.*;
import jakarta.servlet.http.*;
import javax.sql.*;
import javax.naming.*;
public class ConnectionPool extends HttpServlet {
	private static final long serialVersionUID = 1L;
	@Override
	public void doGet(HttpServletRequest request,
			HttpServletResponse response)
		throws IOException, ServletException
	{
		response.setContentType("text/html");
		response.setCharacterEncoding("UTF-8");
		PrintWriter out = response.getWriter();
		out.println("<!DOCTYPE html><html><body>");
		try {
			InitialContext cxt = new InitialContext();
			if ( cxt == null ) {
				throw new Exception("Uh oh -- no context!");
			}

			DataSource ds = (DataSource) cxt.lookup( "java:/comp/env/jdbc/postgres" );

			if ( ds == null ) {
				throw new Exception("Data source not found!");
			}
			Connection c = ds.getConnection();
			c.setAutoCommit(false);
			String SearchName = "";
			String sql2 = "select * from login where username like ?";
			PreparedStatement pstmt = c.prepareStatement(sql2);
			pstmt.setString(1,"%"+SearchName+"%");
			ResultSet rs = pstmt.executeQuery();
			while(rs.next()){
				String username = rs.getString("username");
				String password = rs.getString("password");
				out.print(username+":"+password+"<br/>");
			}
			DBConUtil.close(c,pstmt,null,rs);
		} catch (Exception e) {
			e.printStackTrace();
			System.err.println(e.getClass().getName() + ": " + e.getMessage());
		}
		out.println("select query is ok!<br/>");
		out.println("</body></html>");
	}
}
```
### é…ç½®è·¯ç”±

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220504-1651676119839)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220504-1651676128106)

- è®¿é—®æˆåŠŸï¼ï¼ï¼

## æ€»ç»“

- jdbc connection pool
	- jdbc æ•°æ®åº“è¿æ¥æ± 
	- é¦–å…ˆæ˜¯ä¸€ç§æ± å­
- é€šè¿‡æŒ‡å®šçš„å››æ­¥
	1. é…ç½®jdbcæ•°æ®åº“è¿æ¥æ± çš„jaråŒ…
	2. èµ„æºé…ç½®(context.xmlä¸­è®¾ç½®å…³äºpgçš„Resource)
	3. åœ¨æœ¬åº”ç”¨çš„web.xmlä¸­ä½¿ç”¨ç›¸åº”çš„èµ„æºå¼•ç”¨
	4. åœ¨ç¨‹åºä¸­ä½¿ç”¨jndiè°ƒç”¨æ•°æ®åº“è¿æ¥èµ„æº
- ç»è¿‡è¿™å››æ­¥æˆ‘ä»¬å°±æ„å»ºäº†ä¸€ä¸ªå¯ç”¨çš„æ•°æ®åº“è¿æ¥æ± 
- æˆ‘ä»¬ç”¨è¿™ä¸ªæ•°æ®åº“è¿æ¥æ± å¯ä»¥åšæ€æ ·çš„æ“ä½œå‘¢
	- æ¯”å¦‚åˆ é™¤ï¼ŸğŸ¤”
- ä¸‹æ¬¡å†è¯´ï¼ğŸ‘‹

