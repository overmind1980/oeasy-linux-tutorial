---
show: step
version: 1.0
enable_checker: true
---

# æ–‡æœ¬æ¡†å‰ç«¯éªŒè¯

### å›å¿†
- è¿™æ¬¡è§£å†³äº†é‡å¤ç”¨æˆ·åçš„é—®é¢˜
- ä½†æ˜¯è¿˜æ˜¯å¯èƒ½æœ‰é—®é¢˜çš„
- æ¯”å¦‚æ•°æ®åº“ä¸­æˆ‘ä»¬çš„æ•°æ®å­˜å‚¨å®½åº¦æ˜¯30

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211130-1638244120503)

- å¦‚æœæäº¤çš„å­—ç¬¦ä¸²é•¿åº¦å¤§äº30ï¼Œä¼šå¦‚ä½•å‘¢?ğŸ¤”
- 30æœ‰ç‚¹å¤ªå¤§äº†
- æŠŠåˆ—å®½ç›´æ¥å¹²åˆ°10
- é”™è¯¯å°±å¾ˆå®¹æ˜“å‘ç”Ÿäº†ğŸ˜

### ä¿®æ”¹å­—æ®µé•¿åº¦
```
alter table login alter column username type varchar(10);
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220427-1651027759381)

- ä¿®æ”¹ä¹‹åæƒ³è¦æ’å…¥è¶…è¿‡10ä¸ªå­—ç¬¦çš„å†…å®¹
- æœç„¶å°±æ— æ³•æ’å…¥äº†
- ä¸è¿‡ï¼Œç¨‹åºæ’å…¥çš„æ—¶å€™ä¼šæŠ¥é”™
- æˆ‘ä»¬éœ€è¦åœ¨inserté‡Œé¢è¿›è¡ŒéªŒè¯
- å¹¶ä¸”æŠ¥é”™

### InsertServlet.java

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220427-1651056214844)

- è¿™æ ·å°±å¯ä»¥é‡å®šå‘åˆ°/error
- msg=usernameTooLong
- è¿™ä¸ªæ¶ˆæ¯éœ€è¦åœ¨ErrorServleté‡Œé¢å¤„ç†

### ErroServlet.java

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211130-1638255977300)

- æˆ‘å†å»æ³¨å†Œä¸€ä¸ªç‰¹åˆ«é•¿çš„ç”¨æˆ·å

### é‡æ–°æ³¨å†Œ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211130-1638257480923)

- å¦‚æœæäº¤çš„ç”¨æˆ·åå¤§äº10çš„è¯
- ä¼šç›´æ¥é‡å®šå‘/error
- ä¸è¿‡å¦‚æœç”¨æˆ·åå¤§äº10çš„è¯åº”è¯¥ç›´æ¥è·³è½¬
- è¿˜éœ€è¦æ‰§è¡ŒæŸ¥è¯¢ä¹ˆï¼Ÿ

### ç›®å‰æ¬¡åº

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220427-1651057329152)

- ä¸ç”¨å»æ‰§è¡Œçº¢æ¡†ä¸­çš„æŸ¥è¯¢
- ä»£ç é¡ºåºéœ€è¦è°ƒæ•´

### ä¿®æ”¹ä»£ç 
```java
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.Statement;
import java.io.IOException;
import java.io.PrintWriter;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
public class InsertServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;
	@Override
	public void doPost(HttpServletRequest request,
			HttpServletResponse response)
		throws IOException, ServletException{
		request.setCharacterEncoding("utf-8");
		response.setContentType("text/html");
		response.setCharacterEncoding("UTF-8");
		PrintWriter out = response.getWriter();
		Connection c = null;
		Statement stmt = null;
		try {
			Class.forName("org.postgresql.Driver");
			c = DriverManager.getConnection(
					"jdbc:postgresql://localhost:5432/oeasy", "postgres",
					"oeasy@pg");
			c.setAutoCommit(false);
			out.println("db connection is ok!!<br/>");
			stmt = c.createStatement();
			String Username = request.getParameter("username");
			String Password = request.getParameter("password");
			if(null!=Username&&Username.length()>10){
				System.out.println("=====yes username too loog");
				stmt.close();
				c.commit();
				c.close();
				response.sendRedirect("http://localhost:8080/oeasy/error?msg=usernameTooLong");
			}
			else{
				ResultSet rs = stmt.executeQuery("select * from login where Username='"+Username+"'");
				if(rs.next()){
					stmt.close();
					c.commit();
					c.close();
					response.sendRedirect("http://localhost:8080/oeasy/error?msg=usernameExists");
				}
				else{
					String sql = "insert into login(username,password) values('"+Username+"','"+Password+"');";
					System.out.print("sql======================" + sql);
					stmt.executeUpdate(sql);
					stmt.close();
					c.commit();
					c.close();
					response.sendRedirect("http://localhost:8080/oeasy/select");
				}

			}
		} catch (Exception e) {
			e.printStackTrace();
			System.err.println(e.getClass().getName() + ": " + e.getMessage());
		}
	}
}
```

- ä½†æ˜¯å¦‚æœåœ¨ç½‘é¡µå‰ç«¯å°±å¯ä»¥æŠ¥é”™çš„è¯
	- å¯ä»¥é™ä½åå°çš„è¯»å†™å‹åŠ›
	- å¯ä»¥é™ä½ç½‘ç»œä¼ è¾“å‹åŠ›
	- å¯ä»¥ç¬¬ä¸€æ—¶é—´è¿›è¡Œæç¤º
	- å› ä¸ºæµè§ˆå™¨ç›´æ¥å°±æŠ¥äº†é”™äº†

### å‰ç«¯éªŒè¯

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220427-1651058215116)

- å¯ä»¥æ‰¾åˆ°ç”¨æˆ·åæ–‡æœ¬æ¡†å¯¹åº”çš„å­—ç¬¦ä¸²é•¿åº¦
- æˆ‘åœ¨æäº¤çš„æ—¶å€™
- éœ€è¦å…ˆåœ¨å‰ç«¯éªŒè¯
- ç„¶åå†æäº¤

### prepareInsert.html

```html
<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="content-Type" content="text/html;charset=utf-8"/>
		<title>prepareInsert</title>
	</head>
	<body>
		<form id="RegistForm" onsubmit="return doSubmit()" action="./insert" method="post">
			ç”¨æˆ·å:<input id="username" name="username" type="text" />
			<br/>
			å¯†ç :<input id="password" name="password" type="text" />
			<br/>
			<input type="submit"  value="æ³¨å†Œ" >
			<input type="reset" value="é‡ç½®" >
		</form>
	</body>
	<script>
		function doSubmit(){
			var username = document.getElementById("username");
			if(username.value.length>10){
				alert("ç”¨æˆ·åæœ‰"+username.value.length+",è¯·ä¸è¦è¶…è¿‡10ä½");
				return false;
			}
			else{
				var form = document.getElementById("RegistForm");
				form.submit();
			}
		}
	</script>
</html>
```

- æœ‰çš„æ—¶å€™ä¸æ˜¯å¼¹çª—æŠ¥é”™
- è€Œæ˜¯åœ¨ç½‘é¡µä¸ŠæŠ¥é”™
- åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ

### ç½‘é¡µæŠ¥é”™

```html
<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="content-Type" content="text/html;charset=utf-8"/>
		<title>prepareInsert</title>
	</head>
	<body>
		<form id="RegistForm" onsubmit="return doSubmit()" action="./insert" method="post">
			ç”¨æˆ·å:<input id="username" name="username" type="text" />
			<br/>
			å¯†ç :<input id="password" name="password" type="text" />
			<br/>
			<input type="submit"  value="æ³¨å†Œ" >
			<input type="reset" value="é‡ç½®" >
		</form>
		<span id="errormsg"></span>
	</body>
	<script>
		function doSubmit(){
			var username = document.getElementById("username");
			if(username.value.length>10){
				errormsg.innerHTML = "ç”¨æˆ·åæœ‰"+username.value.length+"ä½,è¯·ä¸è¦è¶…è¿‡10ä½";
				return false;
			}
			else{
				var form = document.getElementById("RegistForm");
				form.submit();
			}
		}
	</script>
</html>
```

- å‰ç«¯å·²ç»éªŒè¯äº†
- è¿˜æœ‰å¿…è¦åœ¨åç«¯å†éªŒè¯ä¸€æ¬¡ä¹ˆï¼ŸğŸ¤”

### å‰åç«¯

- å‰ç«¯æ˜¯å ‚å€Œæ˜ç¡®åœ°æ‹’ç»äº†å®¢äºº
	- ä¸èƒ½ç‚¹è’¸ç†ŠæŒ
	- ç¬¬ä¸€æ—¶é—´åœ¨æœ¬åœ°å°±å‘Šè¯‰äº†å®¢äºº
	- èŠ‚çœæ—¶é—´å’Œå¸¦å®½
	- ä½†æ˜¯å®¢äººå¯èƒ½ç›´æ¥å»æ‰¾åˆå§‹
	- å¼ºåˆ¶æ„é€ è¡¨å•å¹¶æäº¤

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20220522-1653178016502)

- åç«¯æ˜¯å¨å¸ˆ
	- è®©å¨å¸ˆç‰¢è®°ä¸èƒ½åšè’¸ç†ŠæŒ
	- è¿™æ ·å°±åœ¨åå¨ç«‹ä¸‹è§„çŸ©
	- é¿å…å¯¹æ•°æ®åº“åšä¸è§„èŒƒæ“ä½œ

### æ€»ç»“
- è¿™æ¬¡è§£å†³äº†ç”¨æˆ·åå­—ç¬¦ä¸²é•¿åº¦æ§åˆ¶é—®é¢˜
	- åç«¯æ§åˆ¶äº†ä¹‹å
	- å†åœ¨å‰ç«¯å…ˆéªŒè¯
	- è¿™æ ·å‰åç«¯éƒ½éªŒè¯
	- å‰ç«¯è´Ÿè´£é«˜æ•ˆ
	- åç«¯è´Ÿè´£ä¿é™©
- ä½†æ˜¯æœ‰çš„æ—¶å€™å¯†ç è¦æ±‚æ¯”è¾ƒé«˜
	- ä¸ä½†è¦æ±‚æœ‰å¤§å†™å°å†™æ•°å­—å’Œç¬¦å·
	- è¿˜è¦æ±‚è¾“å…¥ä¸¤æ¬¡æ¯”å¯¹ä¸€ä¸‹
- è¿™æ€ä¹ˆåšå‘¢?ğŸ¤”
- ä¸‹æ¬¡å†è¯´ï¼ğŸ‘‹