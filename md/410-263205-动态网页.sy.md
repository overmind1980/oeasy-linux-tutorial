---
show: step
version: 1.0
enable_checker: true
---

# åŠ¨æ€ç½‘é¡µ

### å›å¿†

- ä¸Šæ¬¡æˆ‘ä»¬ç¼–è¾‘ Postgres.java æˆåŠŸè®¿é—®äº† pqæ•°æ®åº“
- é¦–å…ˆè¦å¯¼å…¥ç±»åº“
- ç„¶åè¦å¼€å¯æ•°æ®åº“
- å¹¶äº†è§£æ•°æ®åº“çš„ç”¨æˆ·åå¯†ç 
- è¿˜è¦ä½¿ç”¨æ­£ç¡®çš„sqlè¯­å¥
- æˆ‘ä»¬ä¸‹ä¸€æ­¥å°±æ˜¯è¦åœ¨æµè§ˆå™¨é‡Œé¢æŠŠé¡µé¢æ˜¾ç¤ºå‡ºæ¥
- æ€ä¹ˆåšï¼Ÿ

### æ•´åˆ

- ä¸ä½†æ•´åˆä»£ç 
- ä¹Ÿè¦æ•´åˆéœ€è¦ç”¨åˆ°çš„åŒ…

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210912-1631454705074)

### ç¼–è¯‘

```
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.Statement;
import java.io.IOException;
import java.io.PrintWriter;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
public class SelectServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;
    @Override
    public void doGet(HttpServletRequest request,
                      HttpServletResponse response)
        throws IOException, ServletException
    {
        response.setContentType("text/html");
        response.setCharacterEncoding("UTF-8");
        PrintWriter out = response.getWriter();
        out.println("<!DOCTYPE html><html><body>");
		Connection c = null;
		Statement stmt = null;
		try {
			Class.forName("org.postgresql.Driver");
			c = DriverManager.getConnection(
					"jdbc:postgresql://localhost:5432/oeasy", "postgres",
					"oeasy@pq");
			c.setAutoCommit(false);

			out.println("connection is ok<br/>");
			stmt = c.createStatement();

			ResultSet rs = stmt.executeQuery("select * from urls where topic like 's%'");
			while(rs.next()){
				String topic = rs.getString("topic");
				String url = rs.getString("url");
				out.print(topic+":"+url+"<br/>");
			}
			rs.close();
			stmt.close();
			c.close();

		} catch (Exception e) {
			e.printStackTrace();
			System.err.println(e.getClass().getName() + ": " + e.getMessage());
			System.exit(0);
		}
		out.println("select query is ok!<br/>");
        out.println("</body></html>");
    }
}
```

- ç¼–è¯‘æ²¡æœ‰é—®é¢˜
- é‡å¯æœåŠ¡å™¨

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210912-1631455044287)

- åœ¨æµè§ˆå™¨ä¸­è®¿é—®èµ„æº

### è®¿é—®

- å½“æˆ‘è®¿é—® http://localhost:8080 çš„æ—¶å€™
- tomcatå¯åŠ¨ç€
- åæ¥æˆ‘è®¿é—® http://localhost:8080/oeasy/oeasy
- æœåŠ¡å™¨ç›´æ¥å´©æºƒäº†
- http://localhost:8080 éƒ½æ— æ³•è®¿é—®äº†
- æˆ‘å»çœ‹ä¸€ä¸‹tomcatçš„æ—¥å¿—

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210912-1631455374177)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20210912-1631455551365)

- å¥½åƒæ˜¯postgresql æ²¡æœ‰å¯åŠ¨æœåŠ¡
- å› ä¸ºäº‘ç¯å¢ƒé‡å¯ä¹‹å
- ç¯å¢ƒè¿˜åœ¨ä½†pqæ²¡æœ‰å¯åŠ¨æœåŠ¡

### é‡æ¥

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211121-1637502042563)

- çœ‹èµ·æ¥æ˜¯ä»urlåˆ°classæ²¡æœ‰ç›¸åº”çš„è·¯ç”±
- é‚£ä¹ˆæˆ‘ä»¬è¦é…ç½®web.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
                      http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"
  version="3.1">

    <display-name>Hello, World Application</display-name>
    <description>
        This is a simple web application with a source code organization
        based on the recommendations of the Application Developer's Guide.
    </description>

    <servlet>
        <servlet-name>HelloServlet</servlet-name>
        <servlet-class>HelloWorldExample</servlet-class>
    </servlet>

    <servlet-mapping>
        <servlet-name>HelloServlet</servlet-name>
        <url-pattern>/hello</url-pattern>
    </servlet-mapping>

    <servlet>
        <servlet-name>OeasyServlet</servlet-name>
        <servlet-class>OeasyServlet</servlet-class>
    </servlet>

    <servlet-mapping>
        <servlet-name>OeasyServlet</servlet-name>
        <url-pattern>/oeasy</url-pattern>
    </servlet-mapping>

    <servlet>
        <servlet-name>SelectServlet</servlet-name>
        <servlet-class>SelectServlet</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>SelectServlet</servlet-name>
        <url-pattern>/select</url-pattern>
    </servlet-mapping>
</web-app>
```

- æˆ‘ä»¬é…ç½®web.xml
	- æ³¨æ„æœ€åä¸€ç»„æ˜ å°„
- ç„¶åé‡å¯æœåŠ¡å™¨

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211121-1637502525096)

- é¡ºåˆ©åœ°è¯»å‡ºäº†postgresé‡Œé¢çš„oeasyåº“ä¸­çš„urlsè¡¨ä¸­çš„ä¿¡æ¯ï¼ï¼ï¼
- å¾ˆå¼€å¿ƒï¼
- æ•´åˆæˆåŠŸ


### æ€»ç»“
- æˆ‘ä»¬è¿™æ¬¡æ­å»ºäº†tomcaté€šè¿‡servletè®¿é—®postgresæ•°æ®åº“
- åœ¨webappä¸‹é¢çš„WEB-INF/web.xmlä¸­
	- å»ºç«‹äº† url-pattern å’Œ servlet-name ä¹‹é—´çš„å…³ç³»
	- å»ºç«‹äº† servlet-name å’Œ servlet-class ä¹‹é—´çš„å…³ç³»
- åˆ¶ä½œäº† servlet çš„ class å¹¶ä¸”å†æµè§ˆå™¨ä¸­è®¿é—®
	- è¿™æ ·å°±å¯ä»¥åœ¨æµè§ˆå™¨æŸ¥çœ‹ select è¯­å¥çš„ç»“æœäº†
	- ä¸è¿‡æ¯æ¬¡ä¿®æ”¹ä»£ç éƒ½è¦é‡å¯ tomcat è¿™å¤ªéº»çƒ¦äº†
	- æˆ‘æƒ³è¦ä¸é‡å¯ tomcat è‡ªåŠ¨åŠ è½½ class
- å¯ä»¥ä¹ˆï¼ŸğŸ¤”
- ä¸‹æ¬¡å†è¯´ï¼ğŸ‘‹

