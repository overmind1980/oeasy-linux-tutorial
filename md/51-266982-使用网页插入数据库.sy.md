---
show: step
version: 1.0
enable_checker: true
---

# ç”¨ç½‘é¡µæ’å…¥æ•°æ® - æ–‡æœ¬æ¡†

### å›å¿†

- ä¸Šæ¬¡ç ”ç©¶äº†æ–‡æœ¬æ¡†æäº¤è¡¨å•
- æäº¤è¡¨å•æœ‰ä¸¤ç§æ–¹å¼
	- Get ç›´æ¥å†™åœ¨åœ°å€æ  ç®€å•æ˜äº†
	- Post éšè—èµ·æ¥ ä¿å¯†æ€§å¼º
- æäº¤çš„è¡¨å•è¦æœ‰ä¸€ä¸ªæ¥æ”¶çš„url
- è¿™ä¸ªurlå¯¹åº”çš„servletå¯ä»¥å¤„ç†ç›¸å…³æ•°æ®
	- å¯ä»¥æ’å…¥æ•°æ®åˆ°æ•°æ®åº“
	- æ’å…¥æ•°æ®åˆ°æ•°æ®åº“å‰é¢åšè¿‡
- ç°åœ¨å°±æ˜¯è¦æ•´åˆèµ·æ¥
	- å¦‚ä½•æ•´åˆå‘¢ï¼ŸğŸ¤”
	- æˆ‘ä»¬å…ˆæŠŠä¸¤ä¸ªä»£ç åˆ—å‡ºæ¥

### ä¸¤æ®µä»£ç 

- æ¥æ”¶æäº¤æ•°æ®

```java
import java.io.IOException;
import java.io.PrintWriter;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
public class TestServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;
    public void doPost(HttpServletRequest request,
                      HttpServletResponse response)
        throws IOException, ServletException
    {
		request.setCharacterEncoding("utf-8");
        response.setContentType("text/html");
        response.setCharacterEncoding("utf-8");
        PrintWriter out = response.getWriter();
		String Username = request.getParameter("username");
		String Password = request.getParameter("password");
		out.print("ç”¨æˆ·å:"+Username);
		System.out.print("ç”¨æˆ·å:"+Username);
    }
}
```

- æ’å…¥æ•°æ®


```
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.Statement;
import java.io.IOException;
import java.io.PrintWriter;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
public class InsertServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;
    @Override
    public void doGet(HttpServletRequest request,
                      HttpServletResponse response)
        throws IOException, ServletException
    {
        response.setContentType("text/html");
        response.setCharacterEncoding("UTF-8");
        PrintWriter out = response.getWriter();
		Connection c = null;
		Statement stmt = null;
		try {
			Class.forName("org.postgresql.Driver");
			c = DriverManager.getConnection(
					"jdbc:postgresql://localhost:5432/oeasy", "postgres",
					"oeasy@pq");
			c.setAutoCommit(false);
			stmt = c.createStatement();

			String sql = "insert into urls(topic,url) values('oeasy','http://oeasy.org');";
			System.out.print("sql======================" + sql);
			stmt.executeUpdate(sql);
			stmt.close();
			c.commit();
			c.close();

		} catch (Exception e) {
			e.printStackTrace();
			System.err.println(e.getClass().getName() + ": " + e.getMessage());
		}
		response.sendRedirect("http://localhost:8080/oeasy/select");
    }
}
```

### æ•´åˆä»£ç 

```java
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.Statement;
import java.io.IOException;
import java.io.PrintWriter;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
public class InsertServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;
    @Override
    public void doPost(HttpServletRequest request,
                      HttpServletResponse response)
        throws IOException, ServletException
    {
		request.setCharacterEncoding("utf-8");
        response.setContentType("text/html");
        response.setCharacterEncoding("UTF-8");
        PrintWriter out = response.getWriter();
		Connection c = null;
		Statement stmt = null;
		try {
			Class.forName("org.postgresql.Driver");
			c = DriverManager.getConnection(
					"jdbc:postgresql://localhost:5432/oeasy", "postgres",
					"oeasy@pg");
			c.setAutoCommit(false);
			out.println("db connection is ok!!<br/>");
			stmt = c.createStatement();
			String Username = request.getParameter("username");
			String Password = request.getParameter("password");
			String sql = "insert into login(username,password) values('"+Username+"','"+Password+"');";
			System.out.print("sql======================" + sql);
			stmt.executeUpdate(sql);
			stmt.close();
			c.commit();
			c.close();

		} catch (Exception e) {
			e.printStackTrace();
			System.err.println(e.getClass().getName() + ": " + e.getMessage());
		}
		response.sendRedirect("http://localhost:8080/oeasy/select");
    }
}
```
- ä¿®æ”¹å
	- æ’å…¥çš„æ˜¯loginæ•°æ®åº“
	- æ‰€æœ‰è¦æœ‰ä¸€ä¸ªloginè¡¨

### å»ºè¡¨

```sql
create table login(
	id serial primary key,
	username varchar(30) unique,
	password varchar(30));
```

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211130-1638237412014)

### ç½‘é¡µè¡¨å•çš„action

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211130-1638237716825)

- ä¿®æ”¹ä¹‹åæäº¤

### è¾“å‡ºé‡å®šå‘

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211130-1638237766418)

- responseé‡å®šå‘åˆ°äº†select
- å¯¹åº”SelectServlet.java
- è¿˜æ˜¯åœ¨æŸ¥è¯¢urlsè¡¨
- ç°åœ¨æˆ‘è¦æŸ¥è¯¢loginè¡¨

### ä¿®æ”¹InsertServlet.java
```java
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.Statement;
import java.io.IOException;
import java.io.PrintWriter;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
public class InsertServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;
    @Override
    public void doGet(HttpServletRequest request,
                      HttpServletResponse response)
        throws IOException, ServletException
    {
		request.setCharacterEncoding("utf-8");
        response.setContentType("text/html");
        response.setCharacterEncoding("UTF-8");
        PrintWriter out = response.getWriter();
        out.println("<!DOCTYPE html><html><body>");
		Connection c = null;
		Statement stmt = null;
		try {
			Class.forName("org.postgresql.Driver");
			c = DriverManager.getConnection(
					"jdbc:postgresql://localhost:5432/oeasy", "postgres",
					"oeasy@pg");
			c.setAutoCommit(false);
			out.println("db connection is ok!!<br/>");
			stmt = c.createStatement();
			String Username = request.getParameter("username");
			String Password = request.getParameter("password");
			String sql = "insert into login(username,password) values('"+Username+"','"+Password+"');";
			System.out.print("sql======================" + sql);
			stmt.executeUpdate(sql);
			stmt.close();
			c.commit();
			c.close();

		} catch (Exception e) {
			e.printStackTrace();
			System.err.println(e.getClass().getName() + ": " + e.getMessage());
		}
		response.sendRedirect("http://localhost:8080/oeasy/select");
		out.println(" data query is ok!<br/>");
        out.println("</body></html>");
    }
}
```

### æ’å…¥è¿‡ç¨‹

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20211130-1638239604185)

- ç½‘é¡µä¸­çš„è¡¨å•poståˆ°insertè¿™ä¸ªurl
- InsertServlet.classæ¥æ”¶å¹¶æ’å…¥æ•°æ®åˆ°åº“
- è¾“å‡ºå“åº”é‡å®šå‘åˆ°/selectè¿™ä¸ªurl
- è·¯ç”±åˆ°SelectServlet.class
- SelectServlet.classå»æ•°æ®åº“ä¸­å–å¾—loginåº“çš„å†…å®¹
- ç„¶ååœ¨é¡µé¢å±•ç¤º

### æ€»ç»“
- æˆ‘ä»¬è¿™æ¬¡ç ”ç©¶äº†è¡¨å•æäº¤ä¿¡æ¯çš„å…¥åº“
- æˆ‘ä»¬æ•´åˆäº†æ¥æ”¶postè¿‡æ¥çš„æ•°æ®å’Œæ’å…¥æ•°æ®åº“çš„ä»£ç 
- å°†æ¥æ”¶åˆ°çš„è¡¨å•æ•°æ®ç›´æ¥æ’å…¥æ•°æ®åº“
- ä½†æ˜¯å¦‚æœå·²ç»æœ‰äº†çš„ç”¨æˆ·åï¼Œé‡æ–°æäº¤ä¼šå¦‚ä½•å‘¢ï¼Ÿï¼ŸğŸ¤”
- ä¸‹æ¬¡å†è¯´ï¼ğŸ‘‹