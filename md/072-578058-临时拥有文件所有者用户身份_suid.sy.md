---
show: step
version: 1.0
enable_checker: true
---

# ä¿®æ”¹æ–‡ä»¶æƒé™(chmod)

## å›å¿†

- ä¸Šæ¬¡äº†è§£äº†å‘½ä»¤chown
	- å¯ä»¥ä¿®æ”¹æ–‡ä»¶çš„æ‰€æœ‰è€…
	- ä¹Ÿå¯ä»¥ä¿®æ”¹æ–‡ä»¶çš„æ‰€å±ç»„
- è€Œä¸”
	- è¿˜å¯ä»¥å¯¹äºæ–‡ä»¶å¤¹è®¾ç½®æ‰€æœ‰è€…
	- ç”šè‡³è®¾ç½®é€’å½’åœ°è®¾ç½®æ–‡ä»¶å¤¹çš„æ‰€æœ‰è€…
- è¿™ä¸¤ä¸ªå¯ä»¥é…åˆ
	- é€šè¿‡chownè®¾ç½®æ‰€æœ‰è€…å’Œç»„
	- é€šè¿‡chmodè®¾ç½®æƒé™
- ä½†æ˜¯ä¹Ÿå‘ç°ä¸€äº›é—®é¢˜

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221013-1665625223620)

- sudoå‘½ä»¤çš„å¯æ‰§è¡Œæƒé™æ˜¯s
- è¿™åº”è¯¥å¦‚ä½•ç†è§£å‘¢ï¼Ÿ

### å›å¿†chmod

- chmodå¯ä»¥ä¿®æ”¹æ–‡ä»¶æƒé™
- é çš„æ˜¯æ“ä½œæ–‡ä»¶çš„æƒé™ä½

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221013-1665627887665)

- è¿™æƒé™ä½æŒ‡çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

### æƒé™ä½

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221013-1665627941963)

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221013-1665628047061)

- å¯æ˜¯

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221013-1665625223620)

- sudoå‘½ä»¤çš„å¯æ‰§è¡Œæƒé™æ˜¯s
- è¿™å¦‚ä½•ç†è§£ï¼Ÿ

### æŸ¥çœ‹å¸®åŠ©

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221013-1665629629068)

- setuidæ˜¯1ä½
- æˆ‘å¯ä»¥ç»™æŸä¸ªå¯æ‰§è¡Œæ–‡ä»¶è®¾ç½®è¿™äº›å—ï¼Ÿ

### ä¿®æ”¹setuid

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221013-1665629764574)

- ç¡®å®å¯ä»¥ä¿®æ”¹
- ä¿®æ”¹ä¹‹åæœ‰ä»€ä¹ˆç”¨å—ï¼Ÿ

### æ„å»ºç¯å¢ƒ

- æ–°å»ºtest.c

```
#include <stdio.h>
#include <unistd.h>

int main()
{
    printf("the uid is: %d", geteuid());
    sleep(5);
    // system("rm -f test.txt");
    remove("test.txt");
    return 0;
}
```

- ç¼–è¯‘

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221013-1665630506256)

### æ–°å»ºæ–‡ä»¶

- æ–°å»ºtest.txt

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221013-1665631034841)

- å¹¶æ–°å»ºç”¨æˆ·

### å°è¯•æ‰§è¡Œ

- ç”¨æ–°ç”¨æˆ·ç™»å½•ä¹‹å
- å°è¯•åˆ é™¤test.txtæ–‡ä»¶

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221013-1665631072477)

- å¤±è´¥äº†
- å› ä¸ºæ²¡æœ‰æƒé™
- ä½¿ç”¨åˆšæ‰ç¼–è¯‘çš„testå¯ä»¥åˆ é™¤å—ï¼Ÿ

### å°è¯•åˆ é™¤

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221013-1665631236560)

- ç¨‹åºå¯ä»¥æ‰§è¡Œx
- ä½†æ˜¯txtæ–‡ä»¶æ— æ³•åˆ é™¤
- å¦‚æœæŠŠæ–‡ä»¶çš„æ‰§è¡Œæƒé™ä¿®æ”¹ä¸ºså‘¢ï¼Ÿ

### ä¿®æ”¹æƒé™

- ç”¨shiyanlouå°†test.txtçš„æ‰§è¡Œæƒé™è®¾ç½®ä¸ºs

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221013-1665631536101)

- å°è¯•ä½¿ç”¨oeasyç”¨äºè¿è¡Œ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221013-1665631597685)

- è¿™ä¼šæ–‡ä»¶å°±åˆ é™¤æˆåŠŸäº†
- ä¸ºä»€ä¹ˆå¯ä»¥åˆ é™¤æˆåŠŸå‘¢ï¼Ÿ

### åˆ é™¤åŸç†

- æ‰§è¡Œè¿‡ç¨‹
	- å½“oeasyæƒ³è¦æ‰§è¡Œtestæ—¶
	- oeasy ä¸å±äº testçš„æ‰€æœ‰è€…å’Œç”¨æˆ·ç»„
	- oeasy å±äº o å¯ä»¥æœ‰æ‰§è¡Œæƒé™
	- ç”±äºtestçš„æ‰§è¡Œæƒé™æ˜¯s
	- æ‰€ä»¥å½“å‰ç”¨æˆ·å˜æˆäº†testçš„æ‰€æœ‰è€…shiyanlou
	- shiyanlouæ‹¥æœ‰åˆ é™¤test.txtçš„æƒé™
	- æ‰€ä»¥åˆ é™¤æ–‡ä»¶æˆåŠŸ

- æˆ‘å¯ä»¥åœ¨cè¯­è¨€ç¨‹åºé‡Œé¢ç›´æ¥è®¾ç½®ç”¨æˆ·å—ï¼Ÿ

### ç›´æ¥è®¾ç½®

```
#include <sys/types.h>
#include <unistd.h>
#include <stdio.h>
int main()
{
    printf("real uid is %d---", getuid());
    printf("effective uid is %d---", geteuid());
    getchar();
    if (seteuid(1001) == -1)    /* zzz = 1000 */
    {
        perror("seteuid");
        return -1;
    }
    printf("real uid is %d---", getuid());
    printf("effective uid is %d---", geteuid());
    getchar();
    if (seteuid(0) == -1)       /* root = 1001 */
    {
        perror("seteuid");
        return -1;
    }
    printf("real uid is %d---", getuid());
    printf("effective uid is %d---", geteuid());
    getchar();
}
```

- ç¼–è¯‘ä¹‹åæ‰§è¡Œ

![å›¾ç‰‡æè¿°](https://doc.shiyanlou.com/courses/uid1190679-20221013-1665633361264)

- ç¡®å®ä¹Ÿå¯ä»¥è·å¾—æŒ‡å®šçš„uid
- å»æ€»ç»“ä¸€ä¸‹

### æ€»ç»“ ğŸ¤¨ 
- è¿™æ¬¡ç ”ç©¶äº†suid
	- è¿™ç§æƒé™åœ¨æ–‡ä»¶æ‰€æœ‰è€…çš„æ‰§è¡Œæƒé™ä¸Šæ˜¯ä¸€ä¸ªs
	- æ„å‘³ç€æ‰§è¡Œçš„æ—¶å€™å¯ä»¥ä½¿ç”¨æ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™
	- å¯æ˜¯ä¸ºä»€ä¹ˆè¦è®¾ç½®è¿™æ ·ä¸€ç§æƒé™å‘¢ï¼ŸğŸ¤”
- ä¸‹æ¬¡å†è¯´ğŸ‘‹